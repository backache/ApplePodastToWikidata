#Get  URL
#http://itunes.apple.com/lookup?id=1411257149
$Q = 'Q59314671','Q59532114','Q60462445','Q60696866','Q60697596','Q60742533','Q60743690','Q60997822','Q61565788','Q61711063','Q62022995','Q64023922','Q64084176','Q64398237','Q64535837','Q64536292','Q65029527','Q65057110','Q65062734','Q65062788','Q65068095','Q65079764','Q65080459','Q65084263','Q65086747','Q65090946','Q65091325','Q65091607','Q65112846','Q65118949','Q65120935','Q65148979','Q65160089','Q66314459','Q67199053','Q68131854','Q68789992','Q68892536','Q69526257','Q69624719','Q69737459','Q70345619','Q70380483','Q71379113','Q73611391','Q74342351','Q76167254','Q79388328','Q79389050','Q79389895','Q79393271','Q79675897','Q80575723','Q81403152','Q83060868','Q84263800','Q84864605','Q84993101','Q85748336','Q85790312','Q85808322','Q85851448','Q86082623','Q86914928','Q87648621','Q89128643','Q89339900','Q90785055','Q93458251','Q93984347','Q94311243','Q94956043','Q95626082','Q95992679','Q96100460','Q96406056','Q96409774','Q96410964','Q96757385','Q96757602','Q96759387','Q96786265','Q96786864','Q96787632','Q96788033','Q97182106','Q97184438','Q97184909','Q97188672','Q97313047','Q97354301','Q97376487','Q97861368','Q97930153','Q98593909','Q98593994','Q98594173','Q98594180','Q98594221','Q98594346','Q98605746','Q99541673','Q99746006','Q99934093','Q100151607','Q100725572','Q100896082','Q101011912','Q101011923','Q101011979','Q101012040','Q101012125','Q101013097','Q101093716','Q101354898','Q101356160','Q101359117','Q101367108','Q101378910','Q101397311','Q102941936','Q104062688','Q104553979','Q104632646','Q104636087','Q104698694','Q104758953','Q104819519','Q104868420','Q104880422','Q104881713','Q104992379','Q105038414','Q105097872','Q105098185','Q105234608','Q105409852','Q105424326','Q105424929','Q105425418','Q105425749','Q105437974','Q105554465','Q105612249','Q105808361','Q106087918','Q106320389','Q106337845','Q106338153','Q106370171','Q106370189','Q106370805','Q106378059','Q106395690','Q106497097','Q106548877','Q106584188','Q106588479','Q106634094','Q106666761','Q106697091','Q106773651','Q106775674','Q106786536','Q106800923','Q106812262','Q106812277','Q106814781','Q106819899','Q106882102','Q106903205','Q106944138','Q107070365','Q107095695','Q107122116','Q107148332','Q107148684','Q107148734','Q107157455','Q107168823','Q107214613','Q107307692','Q107309781','Q107351686','Q107371019','Q107381392','Q107410898','Q107590801','Q107657621','Q107895788','Q107925606','Q107980629','Q108127491','Q108604833','Q108796620','Q108796706','Q108800497','Q108843417','Q108864807','Q108884977','Q108885142','Q108919868','Q109248984','Q109292746','Q109323568','Q109374827','Q109379136','Q109379626','Q109447297','Q109498846','Q109507814','Q109520404','Q109527707','Q109540347','Q109614670','Q109654991','Q109661501','Q109673371','Q109746401','Q109750235','Q109851988','Q109892187','Q109892192','Q109892213','Q109892219','Q109892217','Q109892223','Q109892226','Q109892244','Q109892250','Q109892249','Q109892254','Q109892262','Q109892458','Q109892463','Q109892460','Q109892466','Q109892464','Q109892478','Q109892481','Q109892486','Q109892488','Q109892493','Q109892498','Q109892497','Q109892504','Q109892513','Q109892523','Q109892521','Q109892529','Q109892536','Q109892541','Q109892553','Q109892564','Q109892570','Q109892574','Q109892576','Q109892583','Q109892588','Q109892595','Q109892593','Q109892604','Q109892609','Q109892614','Q109892622','Q109892630','Q109892647','Q109892648','Q109892652','Q109943751','Q109943755','Q109943753','Q109943756','Q109943783','Q109943798','Q109943807','Q109943816','Q109943817','Q109943828','Q110062809','Q110137066','Q110147725','Q110211212','Q110275937','Q110402519','Q110475482','Q110549243','Q110555550','Q110555556','Q110555568','Q110555582','Q110555591','Q110555589','Q110555603','Q110555611','Q110555609','Q110555616','Q110555620','Q110568133','Q110568139','Q110568150'
#'Q64821661','Q82983815','Q1200587','Q1200587','Q15642834','Q15642834','Q30321418','Q30321418','Q50413262','Q40888961','Q97354301','Q97354301','Q386813','Q110580446','Q7741969','Q16993790','Q16993790','Q16993790','Q3149655','Q3149655','Q4730021','Q7750858','Q5959191','Q85788850','Q96407604','Q111803358','Q111973069','Q112482384','Q114024420','Q7752224','Q8034355','Q96759383','Q96759383','Q110555592','Q50809782','Q85557071','Q50809782','Q122711825','Q110568021','Q122904459','Q122904596','Q123273180','Q123281872','Q123282026','Q4730021','Q123282100','Q65091537','Q65091537','Q55099148','Q34316','Q34316','Q116312583','Q6899110','Q7753924','Q5132414','Q5132414','Q96408044','Q115685221','Q111803358'
#'Q7627457','Q69624719','Q97933039','Q108167151','Q110555561','Q110555683','Q110555706','Q110555723','Q110555886','Q110555898','Q110555953','Q110555963','Q110555987','Q110568025','Q110568046','Q110568452','Q110568460','Q110568530','Q110568592','Q110568603','Q110568625','Q110568654','Q110568670','Q110568719','Q110568737','Q110568802','Q110568872','Q110568951','Q110573808','Q110573857','Q110573992','Q110574019','Q110574061','Q110574176','Q110574195','Q110574213','Q110574234','Q110574513','Q110574877','Q110574995','Q110575006','Q110575008','Q110575016','Q110575023','Q110575036','Q110575098','Q110575250','Q110575310','Q110575351','Q110575435','Q110575461','Q110575500','Q110580183','Q110829573','Q30640257','Q96409774','Q110568693','Q110568752','Q110568759','Q110568766','Q110568782','Q110568791','Q110568811','Q110568866','Q110568895','Q110568908','Q110568945','Q110573474','Q110573555','Q110573553','Q110573569','Q110573603','Q110573619','Q110573622','Q110573634','Q110573646','Q110573702','Q110573755','Q110573773','Q110573876','Q110573911','Q110573952','Q110573996','Q110574146','Q110574171','Q110574168','Q110574311','Q110574355','Q110574384','Q110574395','Q110574403','Q110574682','Q110574687','Q110574707','Q110574730','Q110574745','Q110574749','Q110574779','Q110574803','Q110574809'
#$QID ="Q83060868"
#to do
# get the podcast logo URL and put it in P10286
# take <itunes:category text="Education"> and set it as genre
# get <link> and make it official website
$errstring=''
$debgstring=''
function Send-Wikidata {

    param (
        $QID
    )
    $out =""

    #Retrieve the wikidata item and put in a variable called WD then show me what you got
    $Response = Invoke-WebRequest -Uri "https://wikidata.org/w/rest.php/wikibase/v0/entities/items/$QID" -UseBasicParsing
    If ($Response.StatusCode -ne "200") {
        # WD failed to respond.
        Write-Host "Message: $($Response.StatusCode) $($Response.StatusDescription)"
    }

    #Make a dictionary of the response from Wikidata
    $WD = $response | ConvertFrom-Json
    #$WD
    #if more than one $URL=$WD.statements.p1019.value.content[1]
    #if just one $URL=$WD.statements.p1019.value.content
   
    #From the WIkidate Dictionary  extra the value of the newest web feed URL
    $APPLEID=$WD.statements.p5842.value.content | Sort-Object -Property ID| Select-Object -first 1
    $URL = 'http://itunes.apple.com/lookup?id='+$APPLEID

    # Go and get Apple's data
    try {
        $Response = Invoke-WebRequest -Uri "$URL" -UseBasicParsing -ContentType "application/xml"

        $Feed =$Response.Content| ConvertFrom-Json 

        [datetime]$date=get-date
        $datestr = $date.ToString("yyyy-MM-dd")
        [datetime]$releasedate = $feed.results.releasedate
        $releasedatestr = $releasedate.ToString("yyyy-MM-dd")
        $span=new-timespan -Start $feed.results.releasedate -End $date
        if ($span.Days -gt 365) {$out = "%7C%7C$QID%7CP582%7C%2b$($releasedatestr)T00:00:00Z%2F11%7CP585%7C%2b$($datestr)T00:00:00Z%2F11%7CS248%7CQ70058728%7CP813"}
        #get the largest number of podcasts the wididata entry has
        $AppleAmount=$Feed.Results.trackCount
        $BiggestWDamount=0
        ForEach ($CountEntry in $WD.statements.p1113.value.content.amount) {
    
            if ($CountEntry.length -gt 0) {$currentcount = $CountEntry.Substring(1)}
            if ($currentcount -gt $BiggestWDamount) {$BiggestWDamount=$currentcount} 
         }
        if ($AppleAmount -gt $BiggestWDamount) {$out = "%7C%7C$QID%7CP1113%7C$AppleAmount%7CP585%7C%2b$($datestr)T00:00:00Z%2F11%7CS248%7CQ70058728%7CP813%7C%2b$($datestr)T00:00:00Z%2F11"}
 
        if ($WD.statements.p10286.value.content.length -eq 0){
            #   Write-Output "set it"
               $logoURL=$feed.Results.artworkUrl600
               if ($logoURL.length -eq 0){$logoURL=$feed.Results.artworkUrl300}
               if ($logoURL.length -eq 0){$logoURL=$feed.Results.artworkUrl100}
               if ($logoURL.length -eq 0){$logoURL=$feed.Results.artworkUrl60}
               if ($logoURL.length -eq 0){$logoURL=$feed.Results.artworkUrl30}
               if ($logoURL.length -gt 0){
               $logoURLencoded=[System.Web.HTTPUtility]::UrlEncode($logoURL)
               $out += "%7C%7C$QID%7CP10286%7C%22$logoURLencoded%22%7CS248%7CQ70058728%7CP813"}
           }

           if ($WD.statements.p1019.value.content.length -eq 0){
            #   Write-Output "set it"
               $rssURL=$feed.Results.feedUrl
               if ($rssURL.length -gt 0){
               $rssURLencoded=[System.Web.HTTPUtility]::UrlEncode($rssURL)
               $out += "%7C%7C$QID%7CP1019%7C%22$rssURLencoded%22%7CS248%7CQ70058728%7CP813"}
           }



    #       $output = "https://quickstatements.toolforge.org/#/v1="
   #$output = $output + $out
   #Start-Process "chrome.exe" "$output"
        
    }
    catch {$errstring+="Cannot download podcast feed for $QID"
} 
    return $out
}
#$out += "%7C%7C$QID%7CP1019%7C$URL%7CP2241%7C$Q1193907"
$output = "https://quickstatements.toolforge.org/#/v1="
$spawncount=0
$ratelimitcount=0
foreach ($Qitem in $Q) {
    $ratelimitcount=$ratelimitcount+1
    $spawncount=$spawncount+1
    $itemoutput = Send-Wikidata($Qitem)
    $output = $output + $itemoutput
    $ratelimitcount
    cls
    if ($ratelimitcount -eq 20) {Start-sleep -seconds 60
        $ratelimitcount=0}
  # if ($spawncount -eq 300) {Start-Process "chrome.exe" "$output"
  # $output = "https://quickstatements.toolforge.org/#/v1="
  #          $spawncount=0}
            
}
       Start-Process "chrome.exe" "$output"
$output
#   Start-Process "chrome.exe" "$output"
